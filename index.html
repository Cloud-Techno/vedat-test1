<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Retro Grid Snake: 2D Yılan Oyunu (Tek Dosya Canvas)</title>

    <style>
      /* CSS Başlangıcı (Gereksinim 1, 4, 5) */
      body {
        margin: 0;
        overflow: hidden;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: #1c1c1c; /* Koyu arka plan */
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }

      /* Oyun Alanı */
      #game-area {
        position: relative;
        width: 100%;
        max-width: 600px; /* Maksimum genişlik */
        aspect-ratio: 1 / 1; /* Kare oran */
        box-shadow: 0 0 30px rgba(74, 255, 145, 0.5); /* Neon ışıltı */
        border-radius: 15px;
        overflow: hidden;
      }

      /* Canvas */
      #game-canvas {
        display: block;
        width: 100%;
        height: 100%;
        background-color: #2c3e50; /* Koyu Mavi Oyun Alanı */
      }

      /* UI Konteyneri (Menüler ve Skor) */
      .ui-container {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 10;
      }

      /* Glassmorphism Panel (Menü ve Game Over) */
      .glass-panel {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        border-radius: 15px;
        border: 1px solid rgba(255, 255, 255, 0.3);
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        padding: 30px;
        color: white;
        text-align: center;
        pointer-events: auto;
        width: 80%;
        max-width: 350px;
      }

      h1,
      h2 {
        font-size: 2.2em;
        text-shadow: 0 0 10px #4aff91; /* Neon Yeşil Başlık */
        color: #ccffdd;
      }

      /* Buton Stilleri */
      .game-button {
        background: rgba(74, 255, 145, 0.9); /* Neon Yeşil */
        border: none;
        color: #00331a;
        font-size: 1.2em;
        padding: 10px 25px;
        margin: 10px 5px;
        border-radius: 50px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: bold;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        pointer-events: auto;
      }

      .game-button:hover {
        background: #ccffdd;
        color: #00331a;
        transform: scale(1.05);
      }

      /* Oyun İçi Skor Paneli (Gereksinim 3) */
      #game-stats {
        position: absolute;
        top: 10px;
        left: 10px;
        font-size: 1.3em;
        padding: 5px 15px;
        background: rgba(0, 0, 0, 0.6);
        border-radius: 5px;
        color: #ccffdd;
      }

      /* Mobil Kontrol (Basit Dokunmatik Joystick - Gereksinim 2) */
      #dpad-container {
        position: absolute;
        bottom: 30px;
        right: 30px;
        display: grid;
        grid-template-areas: ". up ." "left . right" ". down .";
        gap: 8px;
        width: 150px;
        height: 150px;
        pointer-events: auto;
        display: none;
        opacity: 0.7;
      }

      .dpad-btn {
        background: rgba(74, 255, 145, 0.3);
        border: 2px solid #ccffdd;
        border-radius: 10px;
        display: flex;
        justify-content: center;
        align-items: center;
        color: #ccffdd;
        font-size: 1.5em;
        cursor: pointer;
        user-select: none;
        transition: background 0.1s;
      }

      .dpad-btn:active {
        background: rgba(74, 255, 145, 0.8);
      }

      #dpad-up {
        grid-area: up;
      }
      #dpad-down {
        grid-area: down;
      }
      #dpad-left {
        grid-area: left;
      }
      #dpad-right {
        grid-area: right;
      }

      /* Mobil cihazda D-Pad'i göster */
      @media (max-width: 768px) {
        #dpad-container {
          display: grid;
        }
      }
      /* CSS Sonu */
    </style>
  </head>
  <body>
    <div id="game-area">
      <canvas id="game-canvas"></canvas>

      <div class="ui-container">
        <div id="game-stats" style="display: none">
          SKOR: <span id="score">0</span>
        </div>

        <div id="main-menu" class="glass-panel">
          <h1>RETRO GRID SNAKE</h1>
          <p>2D ızgarada hızla büyüyün!</p>
          <button class="game-button" id="start-game-btn">OYUNA BAŞLA</button>
        </div>

        <div id="game-over-screen" class="glass-panel" style="display: none">
          <h2>OYUN BİTTİ!</h2>
          <p>Son Skor: <span id="final-score">0</span></p>
          <button class="game-button" id="restart-game-btn">TEKRAR OYNA</button>
        </div>

        <div id="dpad-container">
          <div class="dpad-btn" id="dpad-up">⬆️</div>
          <div class="dpad-btn" id="dpad-left">⬅️</div>
          <div class="dpad-btn" id="dpad-right">➡️</div>
          <div class="dpad-btn" id="dpad-down">⬇️</div>
        </div>
      </div>
    </div>

    <script>
      // JavaScript Başlangıcı (Gereksinim 1)

      // --- Sabitler ve HTML Elemanları ---
      const canvas = document.getElementById("game-canvas");
      const ctx = canvas.getContext("2d");
      const GRID_SIZE = 20; // Izgara boyutu (20x20)
      let TILE_SIZE; // Her bir blokun piksel cinsinden boyutu
      const GAME_TICK_RATE = 100; // Oyun hızı (ms)

      // --- Oyun Durumu ---
      let snake = [];
      let food = {};
      let direction = { x: 1, y: 0 };
      let nextDirection = { x: 1, y: 0 };
      let score = 0;
      let gameLoop;
      let gameState = "menu"; // 'menu', 'playing', 'gameover'
      let isMobile = /Mobi|Android/i.test(navigator.userAgent);

      // --- Yardımcı Fonksiyonlar ---

      /**
       * Izgara koordinatlarını piksel koordinatlarına dönüştürür ve bloğu çizer.
       */
      function drawTile(x, y, color) {
        ctx.fillStyle = color;
        // Hafif boşluk bırakarak bloklar arasında ızgara etkisi yarat
        const padding = 1;
        ctx.fillRect(
          x * TILE_SIZE + padding,
          y * TILE_SIZE + padding,
          TILE_SIZE - padding * 2,
          TILE_SIZE - padding * 2
        );
      }

      /**
       * Yılanın başlangıç pozisyonunu ayarlar.
       */
      function initializeSnake() {
        snake = [
          { x: 10, y: 10 },
          { x: 9, y: 10 },
          { x: 8, y: 10 },
        ];
        direction = { x: 1, y: 0 };
        nextDirection = { x: 1, y: 0 };
      }

      /**
       * Yemi rastgele bir boş ızgara pozisyonuna yerleştirir.
       */
      function placeFood() {
        let newPos;
        do {
          newPos = {
            x: Math.floor(Math.random() * GRID_SIZE),
            y: Math.floor(Math.random() * GRID_SIZE),
          };
        } while (
          snake.some(
            (segment) => segment.x === newPos.x && segment.y === newPos.y
          )
        );

        food = newPos;
      }

      /**
       * Oyun alanını ve objeleri çizer.
       */
      function drawGame() {
        // Arka planı temizle
        ctx.fillStyle = "#2c3e50"; // Oyun alanı rengi
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        if (gameState !== "playing") return;

        // Yılanı çiz (Gereksinim 5)
        snake.forEach((segment, index) => {
          const color = index === 0 ? "#ff4d4d" : "#4aff91"; // Baş kırmızı, gövde yeşil
          drawTile(segment.x, segment.y, color);
        });

        // Yemi çiz (Gereksinim 5)
        drawTile(food.x, food.y, "#ffff4d"); // Parlak sarı
      }

      /**
       * Yılanı bir adım ilerletir ve oyun mantığını yürütür.
       */
      function moveSnake() {
        // Yönü güncelle (ters yöne dönme engeli)
        if (
          nextDirection.x !== -direction.x ||
          nextDirection.y !== -direction.y
        ) {
          direction = nextDirection;
        }

        // Yeni baş pozisyonunu hesapla
        const newHead = {
          x: snake[0].x + direction.x,
          y: snake[0].y + direction.y,
        };

        // 1. Çarpışma Kontrolü (Duvarlar - Gereksinim 3)
        if (
          newHead.x < 0 ||
          newHead.x >= GRID_SIZE ||
          newHead.y < 0 ||
          newHead.y >= GRID_SIZE
        ) {
          endGame();
          return;
        }

        // 2. Çarpışma Kontrolü (Kendine Çarpma - Gereksinim 3)
        if (
          snake
            .slice(1)
            .some(
              (segment) => segment.x === newHead.x && segment.y === newHead.y
            )
        ) {
          endGame();
          return;
        }

        // Yeni başı ekle
        snake.unshift(newHead);

        // 3. Yem Kontrolü (Gereksinim 3)
        if (newHead.x === food.x && newHead.y === food.y) {
          score += 1;
          updateStatsUI();
          placeFood();
        } else {
          // Yem yemedi, kuyruk segmentini çıkar
          snake.pop();
        }

        drawGame();
      }

      /**
       * Oyunu bitirir ve Game Over ekranını gösterir.
       */
      function endGame() {
        gameState = "gameover";
        clearInterval(gameLoop);

        // Çarpışma anını görselleştir (Yılanı kırmızı yap)
        ctx.fillStyle = "#ff0000";
        snake.forEach((segment) => drawTile(segment.x, segment.y, "#ff0000"));

        document.getElementById("final-score").textContent = score;
        document.getElementById("game-over-screen").style.display = "block";
        document.getElementById("game-stats").style.display = "none";
      }

      /**
       * Skoru günceller.
       */
      function updateStatsUI() {
        document.getElementById("score").textContent = score;
      }

      /**
       * Oyunun ana döngüsünü başlatır.
       */
      function startGameLoop() {
        initializeSnake();
        placeFood();
        score = 0;
        gameState = "playing";
        updateStatsUI();

        // UI Güncellemeleri
        document.getElementById("main-menu").style.display = "none";
        document.getElementById("game-over-screen").style.display = "none";
        document.getElementById("game-stats").style.display = "block";

        // Oyun döngüsünü ayarla (Gereksinim 6 - Pürüzsüz çalışma)
        gameLoop = setInterval(moveSnake, GAME_TICK_RATE);

        // İlk çizimi yap
        drawGame();
      }

      // --- Kontroller ve Olay Dinleyicileri ---

      /**
       * Klavye ve mobil girişlerini işler.
       */
      function handleInput(key) {
        let newDir = { x: direction.x, y: direction.y };

        // PC: Ok Tuşları veya WASD (Gereksinim 2)
        if (key === "ArrowUp" || key === "w" || key === "W") {
          newDir = { x: 0, y: -1 };
        } else if (key === "ArrowDown" || key === "s" || key === "S") {
          newDir = { x: 0, y: 1 };
        } else if (key === "ArrowLeft" || key === "a" || key === "A") {
          newDir = { x: -1, y: 0 };
        } else if (key === "ArrowRight" || key === "d" || key === "D") {
          newDir = { x: 1, y: 0 };
        }

        // Geri gitmeyi engelle
        if (newDir.x !== -direction.x || newDir.y !== -direction.y) {
          nextDirection = newDir;
        }
      }

      /**
       * Canvas'ın boyutunu ve TILE_SIZE'ı ayarlar.
       */
      function resizeCanvas() {
        const gameArea = document.getElementById("game-area");

        // GameArea'nın güncel boyutunu al
        const size = Math.min(window.innerWidth, window.innerHeight, 600);

        // GameArea boyutunu ayarla
        gameArea.style.width = `${size}px`;
        gameArea.style.height = `${size}px`;

        // Canvas boyutunu GameArea boyutuna eşitle
        canvas.width = size;
        canvas.height = size;

        // Blok boyutunu hesapla
        TILE_SIZE = canvas.width / GRID_SIZE;

        // Yeniden çiz
        drawGame();
      }

      // --- Olay Dinleyicileri Kurulumu ---

      window.addEventListener("resize", resizeCanvas);

      // Klavye Dinleyicisi
      document.addEventListener("keydown", (event) => {
        if (gameState === "playing") {
          handleInput(event.key);
        }
      });

      // UI Butonları
      document
        .getElementById("start-game-btn")
        .addEventListener("click", startGameLoop);
      document
        .getElementById("restart-game-btn")
        .addEventListener("click", startGameLoop);

      // Mobil Kontrol (D-Pad) Dinleyicileri (Gereksinim 2)
      if (isMobile) {
        document
          .getElementById("dpad-up")
          .addEventListener("touchstart", (e) => {
            e.preventDefault();
            if (gameState === "playing") handleInput("ArrowUp");
          });
        document
          .getElementById("dpad-down")
          .addEventListener("touchstart", (e) => {
            e.preventDefault();
            if (gameState === "playing") handleInput("ArrowDown");
          });
        document
          .getElementById("dpad-left")
          .addEventListener("touchstart", (e) => {
            e.preventDefault();
            if (gameState === "playing") handleInput("ArrowLeft");
          });
        document
          .getElementById("dpad-right")
          .addEventListener("touchstart", (e) => {
            e.preventDefault();
            if (gameState === "playing") handleInput("ArrowRight");
          });
      }

      // İlk Yüklemede Boyutlandırma ve Menüyü Gösterme
      resizeCanvas();
      // Ana menü zaten varsayılan olarak görünüyor.

      // JavaScript Sonu
    </script>
  </body>
</html>
